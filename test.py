import numpy as np

def group_nearby_time_stops(values):
    values = sorted(values)
    if len(values) < 2:
        return [values]

    threshold = np.median(np.diff(values))

    groups = [[values[0]]]
    for v in values[1:]:
        if v - groups[-1][-1] <= threshold:
            groups[-1].append(round(v, ndigits=2))
        else:
            groups.append([round(v, ndigits=2)])
    return groups, threshold

time_stops = [0, 0.64, 4.672, 5.173333333333333, 5.674666666666667, 6.176, 6.688, 7.189333333333333, 7.690666666666667, 8.192, 8.704, 9.205333333333334, 9.706666666666667, 10.218666666666667, 10.72, 11.221333333333334, 11.722666666666667, 12.245333333333333, 12.736, 13.237333333333334, 13.738666666666667, 14.250666666666667, 14.752, 15.253333333333334, 15.754666666666667, 16.266666666666666, 16.768, 17.269333333333332, 17.770666666666667, 18.282666666666668, 18.784, 19.285333333333334, 19.786666666666665, 20.042666666666666, 20.544, 20.8, 24.832, 28.864, 29.365333333333332, 29.877333333333333, 30.378666666666668, 30.88, 31.381333333333334, 31.893333333333334, 32.394666666666666, 32.896, 33.397333333333336, 33.909333333333336, 34.410666666666664, 34.912, 35.413333333333334, 35.925333333333334, 36.42666666666667, 36.928, 37.42933333333333, 37.94133333333333, 38.44266666666667, 38.944, 39.456, 39.95733333333333, 40.458666666666666, 40.96, 41.461333333333336, 41.973333333333336, 42.474666666666664, 42.976, 43.488, 44.053333333333335, 44.256, 44.49066666666667, 44.74666666666667, 45.00266666666667, 45.248, 45.49333333333333, 46.00533333333333, 46.50666666666667, 47.008, 47.52, 48.02133333333333, 48.522666666666666, 49.034666666666666, 49.536, 50.037333333333336, 50.538666666666664, 51.04, 51.552, 52.053333333333335, 52.55466666666667, 53.06666666666667, 53.568, 54.06933333333333, 54.57066666666667, 55.08266666666667, 55.584, 56.08533333333333, 56.586666666666666, 57.09866666666667, 57.6, 58.101333333333336, 58.602666666666664, 59.114666666666665, 59.616, 60.117333333333335, 60.61866666666667, 60.896, 69.216, 69.97333333333333, 76.75733333333334, 77.00266666666667, 77.25866666666667, 77.76, 78.272, 78.77333333333333, 79.27466666666666, 79.776, 80.27733333333333, 80.78933333333333, 81.29066666666667, 81.792, 82.29333333333334, 82.80533333333334, 83.30666666666667, 83.808, 84.32, 84.82133333333333, 85.32266666666666, 85.824, 86.336, 86.83733333333333, 87.33866666666667, 87.84, 88.352, 88.85333333333334, 89.35466666666666, 89.856, 90.368, 90.86933333333333, 91.56266666666667, 92.11733333333333, 92.62933333333334, 93.12, 99.45108333333333]

for i in range(len(time_stops)):
    time_stops[i] = round(time_stops[i], ndigits=2)

groups, thr = group_nearby_time_stops(time_stops, factor=1)
print("Threshold:", thr)

for g in groups:
    print(g)
    
def connect_fast_slow_time_stops(groups):
    connected = []
    for i, g in enumerate(groups):
        
        if i == 0:
            connected.append(g)
            continue
        
        if len(g) == 1 and len(groups[i-1]) == 1:
            connected[-1].append(g[0])
            continue
            
        if len(g) > 1 and len(groups[i-1]) == 1:
            connected[-1].append(g[0])
            continue
            
        if len(groups[i-1]) > 1:
            connected.append(groups[i-1])
            connected.append([groups[i-1][-1], g[0]])
            continue

    return connected
        
            
print("---")

for g in connect_fast_slow_time_stops(groups):
    print(g, "Fast:", np.median(np.diff(g)) <= thr)
    
    